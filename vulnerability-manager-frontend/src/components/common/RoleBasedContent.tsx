import React from 'react';
import { Box, Alert } from '@mui/material';
import { useRoleAccess, UserRole } from '../../hooks/useRoleAccess';

interface RoleBasedContentProps {
  requiredRoles: UserRole[];
  children: React.ReactNode;
  fallback?: React.ReactNode;
  requireAll?: boolean;
}

export const RoleBasedContent: React.FC<RoleBasedContentProps> = ({
  requiredRoles,
  children,
  fallback,
  requireAll = false,
}) => {
  const { hasRole } = useRoleAccess();

  const hasAccess = requireAll
    ? requiredRoles.every(role => hasRole([role]))
    : requiredRoles.some(role => hasRole([role]));

  if (!hasAccess) {
    return (
      <>
        {fallback || (
          <Alert severity="warning">
            Non hai i permessi per visualizzare questo contenuto.
          </Alert>
        )}
      </>
    );
  }

  return <>{children}</>;
};

interface RoleSpecificViewProps {
  views: {
    admin?: React.ReactNode;
    team_leader?: React.ReactNode;
    user?: React.ReactNode;
  };
}

export const RoleSpecificView: React.FC<RoleSpecificViewProps> = ({ views }) => {
  const { isAdmin, isTeamLeader } = useRoleAccess();

  if (isAdmin()) {
    return <>{views.admin || views.user}</>;
  }

  if (isTeamLeader()) {
    return <>{views.team_leader || views.user}</>;
  }

  return <>{views.user}</>;
};

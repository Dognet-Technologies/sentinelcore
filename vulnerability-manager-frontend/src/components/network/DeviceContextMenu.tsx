// src/components/network/DeviceContextMenu.tsx
// Context menu per device con tasto destro

import React from 'react';
import {
  Menu,
  MenuItem,
  ListItemIcon,
  ListItemText,
  Divider,
  Typography,
  Box,
} from '@mui/material';
import {
  Info,
  Build,
  Scanner,
  BugReport,
  Terminal,
} from '@mui/icons-material';

interface DeviceContextMenuProps {
  x: number;
  y: number;
  device: {
    id: string;
    ip_address: string;
    hostname?: string;
    device_type: string;
    vulnerabilities?: number;
  } | null;
  onAction: (action: string) => void;
  onClose: () => void;
}

const DeviceContextMenu: React.FC<DeviceContextMenuProps> = ({
  x,
  y,
  device,
  onAction,
  onClose,
}) => {
  if (!device) return null;

  const hasVulnerabilities = (device.vulnerabilities || 0) > 0;

  return (
    <Menu
      open={true}
      onClose={onClose}
      anchorReference="anchorPosition"
      anchorPosition={{ top: y, left: x }}
    >
      <Box sx={{ px: 2, py: 1 }}>
        <Typography variant="subtitle2" color="text.secondary">
          {device.hostname || device.ip_address}
        </Typography>
        <Typography variant="caption" color="text.secondary">
          {device.device_type} â€¢ {device.vulnerabilities || 0} vulnerabilities
        </Typography>
      </Box>

      <Divider />

      <MenuItem onClick={() => onAction('view')}>
        <ListItemIcon>
          <Info fontSize="small" />
        </ListItemIcon>
        <ListItemText>View Details</ListItemText>
      </MenuItem>

      <MenuItem onClick={() => onAction('scan')}>
        <ListItemIcon>
          <Scanner fontSize="small" />
        </ListItemIcon>
        <ListItemText>Scan Device</ListItemText>
      </MenuItem>

      {hasVulnerabilities && (
        <>
          <Divider />
          <MenuItem onClick={() => onAction('vulnerabilities')}>
            <ListItemIcon>
              <BugReport fontSize="small" color="error" />
            </ListItemIcon>
            <ListItemText>
              View Vulnerabilities ({device.vulnerabilities})
            </ListItemText>
          </MenuItem>

          <MenuItem onClick={() => onAction('fix')}>
            <ListItemIcon>
              <Build fontSize="small" color="primary" />
            </ListItemIcon>
            <ListItemText>Fix Vulnerabilities</ListItemText>
          </MenuItem>
        </>
      )}

      <Divider />

      <MenuItem onClick={() => onAction('terminal')}>
        <ListItemIcon>
          <Terminal fontSize="small" />
        </ListItemIcon>
        <ListItemText>Open Terminal</ListItemText>
      </MenuItem>
    </Menu>
  );
};

export default DeviceContextMenu;

// src/api/workload.ts
// P5: Workload tracking and metrics API client

import apiClient from './client';

export interface UserWorkload {
  user_id: string;
  username: string;
  email: string;
  role: string;
  assigned_devices: number;
  total_vulnerabilities: number;
  open_vulnerabilities: number;
  in_progress_vulnerabilities: number;
  resolved_vulnerabilities: number;
  closed_vulnerabilities: number;
  critical_count: number;
  high_count: number;
  medium_count: number;
  low_count: number;
  total_tasks: number;
  completed_tasks: number;
  failed_tasks: number;
  avg_resolution_hours?: number;
  assigned_plans: number;
  completed_plan_devices: number;
  last_activity?: string;
}

export interface TeamWorkload {
  team_id: string;
  team_name: string;
  contact_email?: string;
  assigned_devices: number;
  total_vulnerabilities: number;
  open_vulnerabilities: number;
  in_progress_vulnerabilities: number;
  resolved_vulnerabilities: number;
  critical_count: number;
  high_count: number;
  medium_count: number;
  low_count: number;
  total_plans: number;
  active_plans: number;
  completed_plans: number;
  team_members: number;
  last_activity?: string;
}

export const workloadApi = {
  // Get current user's workload
  getMyWorkload: async (): Promise<UserWorkload> => {
    const response = await apiClient.get('/api/workload/me');
    return response.data;
  },

  // Get specific user's workload (admin)
  getUserWorkload: async (userId: string): Promise<UserWorkload> => {
    const response = await apiClient.get(`/workload/users/${userId}`);
    return response.data;
  },

  // List all users' workload (admin)
  listUsersWorkload: async (): Promise<UserWorkload[]> => {
    const response = await apiClient.get('/api/workload/users');
    return response.data;
  },

  // Get team workload
  getTeamWorkload: async (teamId: string): Promise<TeamWorkload> => {
    const response = await apiClient.get(`/workload/teams/${teamId}`);
    return response.data;
  },

  // List all teams' workload
  listTeamsWorkload: async (): Promise<TeamWorkload[]> => {
    const response = await apiClient.get('/api/workload/teams');
    return response.data;
  },
};

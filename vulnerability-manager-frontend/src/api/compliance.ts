// src/api/compliance.ts
import axios from 'axios';

const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:8080';

export interface ComplianceReport {
  id: string;
  framework: string;
  version: string;
  status: string;
  score: number;
  findings: number;
  critical_findings: number;
  generated_at: string;
  generated_by: string;
}

export interface ComplianceFinding {
  control_id: string;
  control_name: string;
  status: string;
  vulnerabilities: number;
  severity: string;
}

export interface ComplianceReportResponse {
  report: ComplianceReport;
  findings: ComplianceFinding[];
}

export interface GenerateComplianceReportRequest {
  framework: string;
  scope?: string[];
}

export const complianceApi = {
  async generateReport(data: GenerateComplianceReportRequest): Promise<ComplianceReportResponse> {
    const response = await axios.post<ComplianceReportResponse>(
      `${API_URL}/api/compliance/generate`,
      data,
      { withCredentials: true }
    );
    return response.data;
  },

  async listReports(): Promise<ComplianceReport[]> {
    const response = await axios.get<ComplianceReport[]>(
      `${API_URL}/api/compliance/reports`,
      { withCredentials: true }
    );
    return response.data;
  },
};

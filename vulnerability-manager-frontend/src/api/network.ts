import apiClient from './client';

export interface NetworkDevice {
  id: string;
  ip_address: string;
  mac_address?: string;
  hostname?: string;
  device_type: 'router' | 'switch' | 'firewall' | 'server' | 'workstation' | 'iot' | 'printer' | 'unknown';
  device_status: 'online' | 'offline' | 'unknown';
  vendor?: string;
  os_name?: string;
  os_version?: string;
  open_ports?: number[];
  services?: Record<string, { name: string; version?: string }>;
  first_seen: string;
  last_seen: string;
  created_at: string;
  updated_at: string;
}

export interface NetworkLink {
  id: string;
  source_device_id: string;
  target_device_id: string;
  link_type: string;
  latency_ms?: number;
  hop_count?: number;
  created_at: string;
}

export interface NetworkScan {
  id: string;
  scan_name: string;
  scan_type: string;
  target_range: string;
  status: string;
  devices_found: number;
  started_at?: string;
  completed_at?: string;
  created_by: string;
  created_at: string;
}

export interface NetworkTopology {
  devices: NetworkDevice[];
  links: NetworkLink[];
  scan_info?: NetworkScan;
}

export interface StartScanRequest {
  scan_name: string;
  scan_type: string;
  target_range: string;
}

export interface ScanProgress {
  scan_id: string;
  status: string;
  progress_percent: number;
  devices_found: number;
  message?: string;
}

export const networkApi = {
  // Start a new network scan
  startScan: async (request: StartScanRequest): Promise<ScanProgress> => {
    const response = await apiClient.post('/api/network/scan', request);
    return response.data;
  },

  // Get scan status
  getScanStatus: async (scanId: string): Promise<ScanProgress> => {
    const response = await apiClient.get(`/api/network/scan/${scanId}`);
    return response.data;
  },

  // Get network topology
  getTopology: async (): Promise<NetworkTopology> => {
    const response = await apiClient.get('/api/network/topology');
    return response.data;
  },

  // Get device details
  getDeviceDetails: async (deviceId: string): Promise<any> => {
    const response = await apiClient.get(`/api/network/devices/${deviceId}`);
    return response.data;
  },

  // Execute remediation
  executeRemediation: async (deviceId: string, request: any): Promise<any> => {
    const response = await apiClient.post('/api/network/remediation', request);
    return response.data;
  },
};

import apiClient from './client';
import { Vulnerability, VulnerabilityFilter } from '../types';

export const vulnerabilitiesApi = {
  list: async (filters?: VulnerabilityFilter): Promise<Vulnerability[]> => {
    const response = await apiClient.get('/api/vulnerabilities', { params: filters });
    return response.data;
  },

  get: async (id: string): Promise<Vulnerability> => {
    const response = await apiClient.get(`/api/vulnerabilities/${id}`);
    return response.data;
  },

  create: async (data: Partial<Vulnerability>): Promise<Vulnerability> => {
    const response = await apiClient.post('/api/vulnerabilities', data);
    return response.data;
  },

  update: async (id: string, data: Partial<Vulnerability>): Promise<Vulnerability> => {
    const response = await apiClient.put(`/api/vulnerabilities/${id}`, data);
    return response.data;
  },

  delete: async (id: string): Promise<void> => {
    await apiClient.delete(`/api/vulnerabilities/${id}`);
  },

  assignToTeam: async (vulnerabilityId: string, teamId: string): Promise<void> => {
    await apiClient.post(`/api/vulnerabilities/${vulnerabilityId}/assign`, { team_id: teamId });
  },

  assignToUser: async (vulnerabilityId: string, userId: string): Promise<void> => {
    await apiClient.post(`/api/vulnerabilities/${vulnerabilityId}/assign-user`, { user_id: userId });
  },

  // Check for new vulnerabilities from scanners
  checkNew: async (): Promise<{ found: number; imported: number }> => {
    const response = await apiClient.post('/api/vulnerabilities/check');
    return response.data;
  },

  // Get vulnerabilities assigned to current user
  getMyAssigned: async (): Promise<Vulnerability[]> => {
    const response = await apiClient.get('/api/vulnerabilities/my-assigned');
    return response.data;
  },
};
// src/api/soar.ts
import axios from 'axios';

const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:8080';

export interface WebhookConfig {
  id: string;
  name: string;
  url: string;
  method: string;
  headers: Record<string, any>;
  payload_template: string;
  trigger_on: string[];
  is_enabled: boolean;
  created_at: string;
}

export interface CreateWebhookRequest {
  name: string;
  url: string;
  method?: string;
  headers?: Record<string, any>;
  payload_template: string;
  trigger_on: string[];
}

export interface WebhookExecutionLog {
  id: string;
  webhook_id: string;
  event_type: string;
  status: string;
  response_code?: number;
  error_message?: string;
  executed_at: string;
}

export const soarApi = {
  async listWebhooks(): Promise<WebhookConfig[]> {
    const response = await axios.get<WebhookConfig[]>(
      `${API_URL}/api/soar/webhooks`,
      { withCredentials: true }
    );
    return response.data;
  },

  async createWebhook(data: CreateWebhookRequest): Promise<WebhookConfig> {
    const response = await axios.post<WebhookConfig>(
      `${API_URL}/api/soar/webhooks`,
      data,
      { withCredentials: true }
    );
    return response.data;
  },

  async deleteWebhook(id: string): Promise<void> {
    await axios.delete(
      `${API_URL}/api/soar/webhooks/${id}`,
      { withCredentials: true }
    );
  },

  async triggerWebhook(id: string): Promise<{ status: number; success: boolean }> {
    const response = await axios.post<{ status: number; success: boolean }>(
      `${API_URL}/api/soar/webhooks/${id}/trigger`,
      {},
      { withCredentials: true }
    );
    return response.data;
  },
};

// src/api/userNotifications.ts
// User notifications API client (bell icon)

import apiClient from './client';

export interface UserNotification {
  id: string;
  notification_type: string;
  priority: 'low' | 'medium' | 'high' | 'urgent';
  title: string;
  message: string;
  action_url?: string;
  vulnerability_id?: string;
  team_id?: string;
  actor_name?: string;
  metadata?: any;
  is_read: boolean;
  read_at?: string;
  created_at: string;
}

export interface NotificationListResponse {
  notifications: UserNotification[];
  total_count: number;
  unread_count: number;
}

export interface NotificationCountResponse {
  unread_count: number;
}

export const userNotificationsApi = {
  // Get unread count
  getUnreadCount: async (): Promise<NotificationCountResponse> => {
    const response = await apiClient.get<NotificationCountResponse>('/api/notifications/unread-count');
    return response.data;
  },

  // List notifications
  listNotifications: async (params?: {
    limit?: number;
    offset?: number;
    unread_only?: boolean;
  }): Promise<NotificationListResponse> => {
    const response = await apiClient.get<NotificationListResponse>('/api/notifications', { params });
    return response.data;
  },

  // Mark as read
  markAsRead: async (notificationId: string): Promise<void> => {
    await apiClient.put(`/api/notifications/${notificationId}/read`);
  },

  // Mark all as read
  markAllAsRead: async (): Promise<{ marked_read: number }> => {
    const response = await apiClient.put<{ marked_read: number }>('/api/notifications/read-all');
    return response.data;
  },

  // Dismiss notification
  dismiss: async (notificationId: string): Promise<void> => {
    await apiClient.delete(`/api/notifications/${notificationId}`);
  },
};

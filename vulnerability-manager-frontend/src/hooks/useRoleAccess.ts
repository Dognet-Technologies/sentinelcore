import { useAuth } from '../contexts/AuthContext';

export type UserRole = 'admin' | 'team_leader' | 'user';

interface RoleAccessOptions {
  requiredRoles?: UserRole[];
  requireAll?: boolean;
}

export const useRoleAccess = (options?: RoleAccessOptions) => {
  const { user } = useAuth();

  const hasRole = (roles: UserRole[]): boolean => {
    if (!user) return false;
    return roles.includes(user.role as UserRole);
  };

  const canAccess = (options?: RoleAccessOptions): boolean => {
    if (!user) return false;
    
    if (!options?.requiredRoles || options.requiredRoles.length === 0) {
      return true;
    }

    if (options.requireAll) {
      return options.requiredRoles.every(role => user.role === role);
    }

    return options.requiredRoles.includes(user.role as UserRole);
  };

  const isAdmin = () => user?.role === 'admin';
  const isTeamLeader = () => user?.role === 'team_leader';
  const isRegularUser = () => user?.role === 'user';

  const canManageUsers = () => isAdmin();
  const canManageTeams = () => isAdmin() || isTeamLeader();
  const canViewReports = () => true;
  const canCreateReports = () => isAdmin() || isTeamLeader();
  const canManagePlugins = () => isAdmin();

  return {
    user,
    hasRole,
    canAccess: options ? canAccess(options) : canAccess(),
    isAdmin,
    isTeamLeader,
    isRegularUser,
    canManageUsers,
    canManageTeams,
    canViewReports,
    canCreateReports,
    canManagePlugins,
  };
};

// src/types/index.ts

export type Role = 'admin' | 'team_leader' | 'user';

// User types
export interface User {
  id: string; // Changed from number to string to match UUID from backend
  username: string;
  email?: string;
  role: Role;
  reputation_score?: number;
  avatar_url?: string;
  created_at?: string;
  updated_at?: string;
  last_login?: string;
  stats?: {
    reports_created: number;
    vulnerabilities_reported: number;
    hosts_managed: number;
  };
}

export interface LoginCredentials {
  username: string;
  password: string;
}

export interface AuthResponse {
  token: string;
  user: User;
}

// Vulnerability enums - matching Rust backend
export enum VulnerabilityStatus {
  Open = 'open',
  InProgress = 'in_progress',
  Resolved = 'resolved',
  Closed = 'closed'
}

export enum VulnerabilitySeverity {
  Critical = 'critical',
  High = 'high',
  Medium = 'medium',
  Low = 'low',
  Info = 'info'
}

// Vulnerability types
export interface Vulnerability {
  id: string;
  title: string;
  description: string;
  cvss_score: number;
  epss_score?: number;
  ip_address: string;
  hostname?: string;
  port?: number;
  protocol?: string;
  status: VulnerabilityStatus;
  severity: VulnerabilitySeverity;
  cve_id?: string;
  cwe_id?: string;
  remediation?: string;
  source: string;
  discovered_at: string;
  created_at: string;
  updated_at: string;
  asset_id?: string;
  assigned_team_id?: string;
  assigned_team_name?: string;
  assigned_user_id?: string;
  assigned_user_name?: string;

  // Risk scoring fields
  risk_score?: number;
  risk_tier?: string;
  sla_deadline?: string;
  sla_breached?: boolean;

  // Legacy fields for backward compatibility
  host_id?: number;
  name?: string;
  resolved_at?: string;
  plugin_id?: string;
  plugin_name?: string;
  solution?: string;
}

export interface VulnerabilityFilter {
  status?: VulnerabilityStatus;
  severity?: VulnerabilitySeverity;
  ip_address?: string;
  hostname?: string;
  cve_id?: string;
  assigned_team_id?: string;
  asset_id?: string;
}

// Asset types
export interface Asset {
  id: string;
  name: string;
  asset_type: string;
  type?: string; // legacy alias
  ip_address?: string;
  hostname?: string;
  os?: string;
  description?: string;
  criticality?: string;
  owner?: string;
  location?: string;
  tags?: string[];
  vulnerability_count?: number;
  created_at: string;
  updated_at: string;
}

// Host types (legacy compatibility)
export interface Host {
  id: string;  // Changed from number to string for UUID compatibility
  name: string;  // Asset name from backend
  hostname?: string;
  ip_address?: string;
  os?: string;
  description?: string;
  asset_type?: string;
  vulnerability_count?: number;
  last_scan?: string;
  created_at: string;
  updated_at: string;
}

// Team types
export interface Team {
  id: string;
  name: string;
  description?: string;
  contact_email?: string;
  slack_webhook?: string;
  telegram_chat_id?: string;
  members_count?: number;
  created_at: string;
  updated_at: string;
}

export interface TeamMember {
  id: string;
  team_id: string;
  user_id?: string;
  name: string;
  email: string;
  role?: string;
  joined_at?: string;
  removed_at?: string;
  created_at: string;
}

export interface NewTeam {
  name: string;
  description?: string;
  contact_email?: string;
  slack_webhook?: string;
  telegram_chat_id?: string;
}

// Plugin types
export interface Plugin {
  id: string;
  name: string;
  display_name: string;
  version: string;
  author: string;
  description?: string;
  type: 'import' | 'export' | 'notification' | 'analysis' | 'integration' | 'other';
  language: string;
  enabled: boolean;
  path: string;
  config: any;
  created_at: string;
  updated_at: string;
}

export interface NewPlugin {
  name: string;
  display_name: string;
  version: string;
  author: string;
  description?: string;
  plugin_type: 'import' | 'export' | 'notification' | 'analysis' | 'integration' | 'other';
  language: string;
  path: string;
  config?: any;
}

export interface UpdatePlugin {
  display_name?: string;
  version?: string;
  description?: string;
  enabled?: boolean;
  config?: any;
}

// Report types
export interface Report {
  id: string;
  name: string;
  report_type: 'scan' | 'manual' | 'export';
  format: 'xml' | 'json' | 'csv' | 'pdf' | 'text';
  status: 'pending' | 'processing' | 'completed' | 'failed';
  source: string;
  error_message?: string;
  processed_vulns?: number;
  file_path?: string;
  created_by: string;
  created_by_name?: string;
  scan_date?: string;
  total_vulns?: number;
  created_at: string;
  updated_at: string;
}

// Management Report types
export interface ManagementReport {
  report_id: string;
  report_name: string;
  period_start: string;
  period_end: string;
  generated_at: string;
  generated_by: string;
  executive_summary: ExecutiveSummary;
  management_metrics: ManagementMetrics;
  risk_analysis: RiskAnalysis;
  team_performance: TeamPerformance[];
  vulnerability_details: VulnerabilityDetails;
}

export interface ExecutiveSummary {
  total_vulnerabilities: number;
  new_vulnerabilities: number;
  resolved_vulnerabilities: number;
  open_vulnerabilities: number;
  in_progress_vulnerabilities: number;
  risk_eliminated: number;
  residual_risk: number;
  positive_trend: boolean;
  net_change: number;
}

export interface ManagementMetrics {
  avg_resolution_time: ResolutionTimeBySevert;
  sla_compliance: SlaCompliance;
  backlog_aging: BacklogAging;
  overall_mttr: number;
}

export interface ResolutionTimeBySevert {
  critical?: number;
  high?: number;
  medium?: number;
  low?: number;
}

export interface SlaCompliance {
  critical_within_7d: number;
  critical_total: number;
  critical_compliant: number;
  high_within_30d: number;
  high_total: number;
  high_compliant: number;
  medium_within_90d: number;
  medium_total: number;
  medium_compliant: number;
}

export interface BacklogAging {
  age_0_30: number;
  age_31_60: number;
  age_61_90: number;
  age_over_90: number;
}

export interface RiskAnalysis {
  top_open_vulnerabilities: VulnerabilitySummary[];
  top_resolved_vulnerabilities: ResolvedVulnerabilitySummary[];
  risk_by_severity: RiskBySeverity;
  risk_by_asset: AssetRiskSummary[];
}

export interface VulnerabilitySummary {
  id: string;
  title: string;
  severity: string;
  cvss_score: number;
  epss_score?: number;
  status: string;
  ip_address: string;
  hostname?: string;
  days_open: number;
  assigned_to?: string;
}

export interface ResolvedVulnerabilitySummary {
  id: string;
  title: string;
  severity: string;
  cvss_score: number;
  resolved_at: string;
  resolved_by?: string;
  days_to_resolve: number;
  risk_eliminated: number;
}

export interface RiskBySeverity {
  critical_cvss_total: number;
  critical_count: number;
  high_cvss_total: number;
  high_count: number;
  medium_cvss_total: number;
  medium_count: number;
  low_cvss_total: number;
  low_count: number;
}

export interface AssetRiskSummary {
  asset_id?: string;
  asset_name: string;
  asset_type?: string;
  open_vulns: number;
  total_cvss: number;
  critical_count: number;
  high_count: number;
}

export interface TeamPerformance {
  team_id?: string;
  team_name: string;
  vulnerabilities_assigned: number;
  vulnerabilities_resolved: number;
  avg_resolution_time?: number;
  risk_eliminated: number;
  top_contributor?: string;
}

export interface VulnerabilityDetails {
  open: VulnerabilitySummary[];
  in_progress: VulnerabilitySummary[];
  resolved: ResolvedVulnerabilitySummary[];
}

export interface GenerateManagementReportRequest {
  name: string;
  period_start: string;
  period_end: string;
  team_id?: string;
  severity_filter?: string;
  asset_id?: string;
  format: 'pdf' | 'json' | 'csv';
}
// src/App.tsx
import React from 'react';
import { BrowserRouter as Router, Routes, Route, Navigate, Outlet } from 'react-router-dom';
import { CssBaseline } from '@mui/material';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';
import { AuthProvider } from './contexts/AuthContext';
import { EnhancedThemeProvider } from './contexts/EnhancedThemeContext';
import ProtectedRoute from './components/common/ProtectedRoute';
import { EnhancedLayout } from './components/common/EnhancedLayout';
import Login from './pages/Login';
import Dashboard from './pages/Dashboard';
import Vulnerabilities from './pages/Vulnerabilities';
import MyVulnerabilities from './pages/MyVulnerabilities';
import NetworkDiscovery from './pages/NetworkDiscovery';
import Teams from './pages/Teams';
import Users from './pages/Users';
import Plugins from './pages/Plugins';
import Hosts from './pages/Hosts';
import Reports from './pages/Reports';
import NewReport from './pages/NewReport';
import ReportHistory from './pages/ReportHistory';
import ReportView from './pages/ReportView';
import Settings from './pages/Settings';
import Profile from './pages/Profile';
import '@fontsource/inter/400.css';
import '@fontsource/inter/500.css';
import '@fontsource/inter/600.css';
import '@fontsource/inter/700.css';

// Crea un'istanza di QueryClient
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: 1,
      refetchOnWindowFocus: false,
      staleTime: 5 * 60 * 1000, // 5 minuti
    },
  },
});

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Router>
        <AuthProvider>
          <EnhancedThemeProvider>
            <CssBaseline />
            <Routes>
              <Route path="/login" element={<Login />} />
              <Route element={<ProtectedRoute><Outlet /></ProtectedRoute>}>
                <Route element={<EnhancedLayout />}>
                  <Route path="/" element={<Navigate to="/dashboard" replace />} />
                  <Route path="/dashboard" element={<Dashboard />} />
                  <Route path="/vulnerabilities" element={<Vulnerabilities />} />
                  <Route path="/vulnerabilities/:id" element={<Vulnerabilities />} />
                  <Route path="/discovery" element={<MyVulnerabilities />} />
                  <Route path="/network" element={<NetworkDiscovery />} />
                  <Route path="/hosts" element={<Hosts />} />
                  <Route path="/reports" element={<Reports />} />
                  <Route path="/reports/new" element={<NewReport />} />
                  <Route path="/reports/history" element={<ReportHistory />} />
                  <Route path="/reports/:id" element={<ReportView />} />
                  <Route path="/teams" element={<Teams />} />
                  <Route path="/users" element={<Users />} />
                  <Route path="/plugins" element={<Plugins />} />
                  <Route path="/settings" element={<Settings />} />
                  <Route path="/profile" element={<Profile />} />
                </Route>
              </Route>
            </Routes>
          </EnhancedThemeProvider>
        </AuthProvider>
      </Router>
      {/* Opzionale: React Query Devtools per debug */}
      <ReactQueryDevtools initialIsOpen={false} />
    </QueryClientProvider>
  );
}

export default App;
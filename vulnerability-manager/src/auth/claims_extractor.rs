// src/auth/claims_extractor.rs
// ADDED: Extractor per Claims per Axum 0.6

use axum::{
    async_trait,
    extract::FromRequestParts,
    http::{StatusCode, request::Parts},
};

use super::Claims;

#[async_trait]
impl<S> FromRequestParts<S> for Claims
where
    S: Send + Sync,
{
    type Rejection = StatusCode;

    async fn from_request_parts(parts: &mut Parts, _state: &S) -> Result<Self, Self::Rejection> {
        parts
            .extensions
            .get::<Claims>()
            .cloned()
            .ok_or(StatusCode::UNAUTHORIZED)
    }
}

// Compatibility with old FromRequest trait if needed
// #[async_trait]
// impl<S, B> FromRequest<S, B> for Claims
// where
//     B: Send + 'static,
//     S: Send + Sync,
// {
//     type Rejection = StatusCode;

//     async fn from_request(req: axum::http::Request<B>, state: &S) -> Result<Self, Self::Rejection> {
//         let (mut parts, _body) = req.into_parts();
//         Self::from_request_parts(&mut parts, state).await
//     }
// }
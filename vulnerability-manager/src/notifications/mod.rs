// src/notifications/mod.rs
// Sistema di notifiche multi-canale

pub mod slack;
pub mod telegram;
pub mod email;

use serde::{Deserialize, Serialize};
use uuid::Uuid;

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct NotificationPayload {
    pub vulnerability_id: Uuid,
    pub title: String,
    pub severity: String,
    pub cvss_score: f32,
    pub ip_address: String,
    pub description: String,
    pub team_name: Option<String>,
}

#[derive(Debug, Clone)]
pub enum NotificationChannel {
    Slack(String),      // webhook_url
    Telegram(String),   // chat_id
    Email(String),      // email_address
}

pub async fn send_notification(
    payload: NotificationPayload,
    channel: NotificationChannel,
) -> Result<(), Box<dyn std::error::Error>> {
    match channel {
        NotificationChannel::Slack(webhook_url) => {
            slack::send_slack_notification(&webhook_url, payload).await
        }
        NotificationChannel::Telegram(chat_id) => {
            telegram::send_telegram_notification(&chat_id, payload).await
        }
        NotificationChannel::Email(email) => {
            email::send_email_notification(&email, payload).await
        }
    }
}

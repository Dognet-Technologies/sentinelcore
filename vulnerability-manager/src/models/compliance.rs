use serde::{Deserialize, Serialize};
use uuid::Uuid;
use chrono::{DateTime, Utc};

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ComplianceFramework {
    pub id: Uuid,
    pub name: String,
    pub version: String,
    pub description: Option<String>,
    pub controls: serde_json::Value,
    pub is_active: bool,
    pub created_at: DateTime<Utc>,
    pub updated_at: DateTime<Utc>,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ComplianceReport {
    pub id: Uuid,
    pub framework: String,
    pub version: Option<String>,
    pub status: String,
    pub scope: serde_json::Value,
    pub score: f64,
    pub total_controls: i32,
    pub passed_controls: i32,
    pub failed_controls: i32,
    pub findings: i32,
    pub critical_findings: i32,
    pub high_findings: i32,
    pub medium_findings: i32,
    pub low_findings: i32,
    pub report_data: serde_json::Value,
    pub generated_by: Uuid,
    pub generated_at: DateTime<Utc>,
    pub valid_from: Option<DateTime<Utc>>,
    pub valid_to: Option<DateTime<Utc>>,
    pub created_at: DateTime<Utc>,
    pub updated_at: DateTime<Utc>,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ComplianceFinding {
    pub id: Uuid,
    pub report_id: Uuid,
    pub control_id: String,
    pub control_name: String,
    pub control_description: Option<String>,
    pub status: String,
    pub vulnerabilities: i32,
    pub vulnerability_ids: Vec<Uuid>,
    pub severity: String,
    pub evidence: Option<String>,
    pub recommendation: Option<String>,
    pub created_at: DateTime<Utc>,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ComplianceControl {
    pub id: String,
    pub name: String,
    pub description: Option<String>,
    pub category: String,
    pub severity: String,
    pub cwe_ids: Vec<String>,
}

#[derive(Debug, Deserialize)]
pub struct GenerateComplianceReportRequest {
    pub framework: String,
    pub scope: Option<Vec<Uuid>>,
    pub valid_to: Option<DateTime<Utc>>,
}

#[derive(Debug, Serialize)]
pub struct ComplianceReportResponse {
    pub report: ComplianceReport,
    pub findings: Vec<ComplianceFinding>,
    pub score_breakdown: ComplianceScoreBreakdown,
}

#[derive(Debug, Serialize)]
pub struct ComplianceScoreBreakdown {
    pub total_controls: i32,
    pub passed_controls: i32,
    pub failed_controls: i32,
    pub compliance_percentage: f32,
    pub critical_violations: i32,
    pub high_violations: i32,
    pub medium_violations: i32,
}

#[derive(Debug, Serialize)]
pub struct ComplianceFrameworkResponse {
    pub framework: ComplianceFramework,
    pub controls: Vec<ComplianceControl>,
}

#[derive(Debug, Deserialize)]
pub struct CreateComplianceReportPayload {
    pub framework: String,
    pub asset_ids: Option<Vec<Uuid>>,
}

use serde::{Deserialize, Serialize};
use uuid::Uuid;
use chrono::{DateTime, Utc};

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct RiskAcceptance {
    pub id: Uuid,
    pub vulnerability_id: Uuid,
    pub accepted_by: Uuid,
    pub accepted_at: DateTime<Utc>,
    pub justification: String,
    pub mitigating_controls: String,
    pub approval_status: String,
    pub approved_by: Option<Uuid>,
    pub approval_comment: Option<String>,
    pub approved_at: Option<DateTime<Utc>>,
    pub valid_from: DateTime<Utc>,
    pub expires_at: DateTime<Utc>,
    pub renewal_reminder_sent: bool,
    pub renewal_reminder_sent_at: Option<DateTime<Utc>>,
    pub requires_quarterly_review: bool,
    pub last_review_date: Option<DateTime<Utc>>,
    pub next_review_date: Option<DateTime<Utc>>,
    pub review_notes: Option<String>,
    pub created_at: DateTime<Utc>,
    pub updated_at: DateTime<Utc>,
}

#[derive(Debug, Deserialize)]
pub struct CreateRiskAcceptanceRequest {
    pub vulnerability_id: Uuid,
    pub justification: String,
    pub mitigating_controls: String,
    pub expires_at: DateTime<Utc>,
    pub requires_quarterly_review: Option<bool>,
}

#[derive(Debug, Deserialize)]
pub struct ApproveRiskAcceptanceRequest {
    pub comment: Option<String>,
}

#[derive(Debug, Deserialize)]
pub struct RejectRiskAcceptanceRequest {
    pub comment: String,
}

#[derive(Debug, Deserialize)]
pub struct RenewRiskAcceptanceRequest {
    pub expires_at: DateTime<Utc>,
    pub updated_justification: Option<String>,
    pub updated_controls: Option<String>,
}

#[derive(Debug, Deserialize)]
pub struct ReviewRiskAcceptanceRequest {
    pub decision: String,
    pub decision_notes: Option<String>,
    pub next_review_date: Option<DateTime<Utc>>,
}

#[derive(Debug, Clone, Serialize)]
pub struct RiskAcceptanceResponse {
    pub id: Uuid,
    pub vulnerability_id: Uuid,
    pub vulnerability_title: String,
    pub accepted_by: Uuid,
    pub accepted_by_name: String,
    pub accepted_at: DateTime<Utc>,
    pub justification: String,
    pub mitigating_controls: String,
    pub approval_status: String,
    pub approved_by: Option<Uuid>,
    pub approved_by_name: Option<String>,
    pub approval_comment: Option<String>,
    pub approved_at: Option<DateTime<Utc>>,
    pub valid_from: DateTime<Utc>,
    pub expires_at: DateTime<Utc>,
    pub days_until_expiry: i32,
    pub is_expired: bool,
    pub requires_quarterly_review: bool,
    pub last_review_date: Option<DateTime<Utc>>,
    pub next_review_date: Option<DateTime<Utc>>,
    pub review_notes: Option<String>,
    pub created_at: DateTime<Utc>,
    pub updated_at: DateTime<Utc>,
}

#[derive(Debug, Clone, Serialize)]
pub struct RiskAcceptanceApproval {
    pub id: Uuid,
    pub risk_acceptance_id: Uuid,
    pub approver_id: Uuid,
    pub approver_name: String,
    pub approver_role: String,
    pub status: String,
    pub comment: Option<String>,
    pub approved_at: Option<DateTime<Utc>>,
    pub created_at: DateTime<Utc>,
}

#[derive(Debug, Clone, Serialize)]
pub struct RiskAcceptanceReview {
    pub id: Uuid,
    pub risk_acceptance_id: Uuid,
    pub reviewed_by: Uuid,
    pub reviewed_by_name: String,
    pub reviewed_at: DateTime<Utc>,
    pub decision: String,
    pub decision_notes: Option<String>,
    pub next_review_date: Option<DateTime<Utc>>,
    pub created_at: DateTime<Utc>,
}

#[derive(Debug, Serialize)]
pub struct RiskAcceptanceListResponse {
    pub acceptances: Vec<RiskAcceptanceResponse>,
    pub total: i64,
    pub pending_approvals: i64,
    pub expiring_soon: i64,
    pub due_for_review: i64,
}

#[derive(Debug, Deserialize)]
pub struct RiskAcceptanceFilter {
    pub vulnerability_id: Option<Uuid>,
    pub approval_status: Option<String>,
    pub include_expired: Option<bool>,
    pub due_for_review: Option<bool>,
}

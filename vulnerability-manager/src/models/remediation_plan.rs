// src/models/remediation_plan.rs
use chrono::{DateTime, Utc};
use serde::{Deserialize, Serialize};
use uuid::Uuid;

#[derive(Debug, Serialize, Deserialize, Clone, PartialEq, Eq, sqlx::Type)]
#[sqlx(type_name = "varchar", rename_all = "snake_case")]
#[serde(rename_all = "snake_case")]
pub enum RemediationPlanStatus {
    Draft,
    Active,
    InProgress,
    Completed,
    Cancelled,
}

impl RemediationPlanStatus {
    pub fn as_str(&self) -> &'static str {
        match self {
            Self::Draft => "draft",
            Self::Active => "active",
            Self::InProgress => "in_progress",
            Self::Completed => "completed",
            Self::Cancelled => "cancelled",
        }
    }
}

#[derive(Debug, Serialize, Deserialize, Clone, sqlx::FromRow)]
pub struct RemediationPlan {
    pub id: Uuid,
    pub name: String,
    pub description: Option<String>,
    pub created_by: Uuid,
    pub assigned_team_id: Option<Uuid>,
    pub status: String,  // Using String instead of enum for simpler querying
    pub priority: i32,   // 0-100
    pub due_date: Option<DateTime<Utc>>,
    pub started_at: Option<DateTime<Utc>>,
    pub completed_at: Option<DateTime<Utc>>,
    pub created_at: DateTime<Utc>,
    pub updated_at: DateTime<Utc>,
}

#[derive(Debug, Serialize, Deserialize)]
pub struct NewRemediationPlan {
    pub name: String,
    pub description: Option<String>,
    pub assigned_team_id: Option<Uuid>,
    pub priority: Option<i32>,  // 0-100, defaults to 50
    pub due_date: Option<DateTime<Utc>>,
}

#[derive(Debug, Serialize, Deserialize)]
pub struct UpdateRemediationPlan {
    pub name: Option<String>,
    pub description: Option<String>,
    pub assigned_team_id: Option<Uuid>,
    pub status: Option<String>,
    pub priority: Option<i32>,
    pub due_date: Option<DateTime<Utc>>,
}

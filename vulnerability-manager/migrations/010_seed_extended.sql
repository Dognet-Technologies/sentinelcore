-- Extended seed data for comprehensive testing
-- This script adds more realistic test data to the database

-- Additional assets with tags field
INSERT INTO assets (name, asset_type, description, ip_address, hostname, operating_system, tags)
VALUES
    ('App Server', 'server', 'Application server running Node.js', '192.168.1.12', 'appserver01.local', 'Linux Ubuntu 22.04', ARRAY['production', 'web']::text[]),
    ('Mail Server', 'server', 'Corporate mail server', '192.168.1.13', 'mailserver01.local', 'Linux Debian 11', ARRAY['production', 'mail']::text[]),
    ('Dev Workstation', 'workstation', 'Developer workstation', '192.168.1.100', 'dev-ws01.local', 'Windows 11', ARRAY['development']::text[]),
    ('File Server', 'server', 'Network file storage', '192.168.1.14', 'fileserver01.local', 'Windows Server 2022', ARRAY['production', 'storage']::text[]),
    ('Firewall', 'network_device', 'Main network firewall', '192.168.1.1', 'firewall01.local', 'pfSense', ARRAY['network', 'security']::text[]);
--    ('Firewall', 'network', 'Main network firewall', '192.168.1.1', 'firewall01.local', 'pfSense', ARRAY['network', 'security']::text[]);


-- Additional vulnerabilities with CIDR format
INSERT INTO vulnerabilities (
    title, description, cvss_score, epss_score, ip_address, hostname,
    port, protocol, status, severity, cve_id, remediation, source, discovered_at
)
VALUES
(
    'Critical Remote Code Execution',
    'A critical RCE vulnerability in the application server allowing unauthenticated remote code execution.',
    9.8,
    0.95,
    '192.168.1.12/32',
    'appserver01.local',
    8080,
    'HTTP',
    'open',
    'critical',
    'CVE-2024-11111',
    'Immediately patch to version 2.5.1 or later and restart the service.',
    'Nessus Scan',
    NOW() - INTERVAL '3 days'
),
(
    'Weak SSH Configuration',
    'SSH server allows weak cipher algorithms and password authentication.',
    5.3,
    0.25,
    '192.168.1.13/32',
    'mailserver01.local',
    22,
    'SSH',
    'open',
    'medium',
    'CVE-2024-22222',
    'Update SSH configuration to disable weak ciphers and enforce key-based authentication.',
    'Manual Scan',
    NOW() - INTERVAL '5 days'
),
(
    'SMB Signing Not Required',
    'SMB signing is not required, allowing potential man-in-the-middle attacks.',
    6.5,
    0.40,
    '192.168.1.14/32',
    'fileserver01.local',
    445,
    'SMB',
    'open',
    'medium',
    NULL,
    'Enable SMB signing in group policy and restart the server.',
    'Nessus Scan',
    NOW() - INTERVAL '1 day'
),
(
    'Outdated PHP Version',
    'Web server running PHP 7.4 which is end-of-life and contains multiple vulnerabilities.',
    7.5,
    0.60,
    '192.168.1.10/32',
    'webserver01.local',
    80,
    'HTTP',
    'in_progress',
    'high',
    'CVE-2024-33333',
    'Upgrade PHP to version 8.2 or later.',
    'OpenVAS',
    NOW() - INTERVAL '4 days'
),
(
    'Information Disclosure via HTTP Headers',
    'Server headers disclose sensitive version information.',
    3.7,
    0.10,
    '192.168.1.12/32',
    'appserver01.local',
    443,
    'HTTPS',
    'resolved',
    'low',
    NULL,
    'Configure web server to suppress version information in headers.',
    'Manual Scan',
    NOW() - INTERVAL '10 days'
),
(
    'Unpatched Windows Vulnerabilities',
    'Multiple missing Windows security updates detected.',
    8.1,
    0.70,
    '192.168.1.100/32',
    'dev-ws01.local',
    NULL,
    NULL,
    'open',
    'high',
    'CVE-2024-44444',
    'Apply all pending Windows updates and enable automatic updates.',
    'WSUS Scan',
    NOW() - INTERVAL '2 days'
),
(
    'Default Credentials on Network Device',
    'Network device still using factory default credentials.',
    9.1,
    0.85,
    '192.168.1.1/32',
    'firewall01.local',
    443,
    'HTTPS',
    'open',
    'critical',
    NULL,
    'Change default admin password immediately and implement password policy.',
    'Manual Scan',
    NOW() - INTERVAL '1 day'
),
(
    'Missing Security Headers',
    'Web application missing critical security headers (CSP, HSTS, X-Frame-Options).',
    4.3,
    0.15,
    '192.168.1.10/32',
    'webserver01.local',
    443,
    'HTTPS',
    'open',
    'low',
    NULL,
    'Configure web server to include security headers in all responses.',
    'OWASP ZAP',
    NOW() - INTERVAL '6 days'
);

-- Additional reports
INSERT INTO reports (name, report_type, format, status, source, created_by, scan_date, total_vulns, processed_vulns)
VALUES
(
    'Weekly Security Scan Report',
    'scan',
    'pdf',
    'completed',
    'Nessus',
    (SELECT id FROM users WHERE username = 'admin'),
    NOW() - INTERVAL '7 days',
    25,
    25
),
(
    'Monthly Vulnerability Assessment',
    'scan',
    'pdf',
    'completed',
    'OpenVAS',
    (SELECT id FROM users WHERE username = 'admin'),
    NOW() - INTERVAL '30 days',
    45,
    45
),
(
    'Quarterly Security Report',
    'manual',
    'pdf',
    'processing',
    'Manual Review',
    (SELECT id FROM users WHERE username = 'team_leader'),
    NOW() - INTERVAL '2 days',
    NULL,
    NULL
);

-- Additional audit logs for activity
INSERT INTO audit_logs (user_id, action, entity_type, entity_id, ip_address, created_at)
VALUES
(
    (SELECT id FROM users WHERE username = 'admin'),
    'create',
    'vulnerability',
    (SELECT id FROM vulnerabilities WHERE title = 'Critical Remote Code Execution'),
    '192.168.1.200',
    NOW() - INTERVAL '3 days'
),
(
    (SELECT id FROM users WHERE username = 'team_leader'),
    'update',
    'vulnerability',
    (SELECT id FROM vulnerabilities WHERE title = 'Outdated PHP Version'),
    '192.168.1.201',
    NOW() - INTERVAL '2 days'
),
(
    (SELECT id FROM users WHERE username = 'admin'),
    'create',
    'report',
    (SELECT id FROM reports WHERE name = 'Weekly Security Scan Report'),
    '192.168.1.200',
    NOW() - INTERVAL '7 days'
);

-- Migration: Add missing columns to remediation_plans table
-- File: migrations/036_add_device_ids_to_remediation_plans.sql

ALTER TABLE remediation_plans 
ADD COLUMN IF NOT EXISTS device_ids UUID[] DEFAULT '{}',
ADD COLUMN IF NOT EXISTS total_devices INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS critical_count INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS high_count INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS medium_count INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS low_count INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS estimated_hours_total DECIMAL(10,2) DEFAULT 0,
ADD COLUMN IF NOT EXISTS estimated_start_date DATE,
ADD COLUMN IF NOT EXISTS estimated_completion_date DATE,
ADD COLUMN IF NOT EXISTS exclude_device_ids UUID[] DEFAULT '{}';

-- Create indexes for RBRE fields if they don't exist
CREATE INDEX IF NOT EXISTS idx_remediation_plans_total_devices ON remediation_plans(total_devices);
CREATE INDEX IF NOT EXISTS idx_remediation_plans_estimated_dates ON remediation_plans(estimated_start_date, estimated_completion_date);

-- Add user_id to team_members table
ALTER TABLE team_members 
ADD COLUMN user_id UUID REFERENCES users(id) ON DELETE CASCADE;

-- Update unique constraint to include user_id
ALTER TABLE team_members 
DROP CONSTRAINT team_members_team_id_email_key;

-- Add new unique constraint
ALTER TABLE team_members 
ADD CONSTRAINT team_members_team_id_user_id_key UNIQUE(team_id, user_id);

-- Create index for faster lookups
CREATE INDEX idx_team_members_user_id ON team_members(user_id);
CREATE INDEX idx_team_members_team_id_user_id ON team_members(team_id, user_id);

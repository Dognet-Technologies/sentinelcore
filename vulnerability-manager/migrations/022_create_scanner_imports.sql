CREATE TABLE scanner_imports (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    scanner_name VARCHAR(100) NOT NULL,
    format VARCHAR(50) NOT NULL,
    source_filename VARCHAR(255),
    total_vulnerabilities INTEGER NOT NULL DEFAULT 0,
    imported_count INTEGER NOT NULL DEFAULT 0,
    skipped_count INTEGER NOT NULL DEFAULT 0,
    errors TEXT,
    imported_by UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    imported_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    metadata JSONB
);

CREATE INDEX idx_scanner_imports_scanner ON scanner_imports(scanner_name);
CREATE INDEX idx_scanner_imports_imported_by ON scanner_imports(imported_by);
CREATE INDEX idx_scanner_imports_imported_at ON scanner_imports(imported_at);

CREATE TABLE scanner_import_vulnerabilities (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    import_id UUID NOT NULL REFERENCES scanner_imports(id) ON DELETE CASCADE,
    vulnerability_id UUID NOT NULL REFERENCES vulnerabilities(id) ON DELETE CASCADE,
    scanner_vulnerability_id VARCHAR(255) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    UNIQUE(import_id, vulnerability_id)
);

CREATE INDEX idx_scanner_import_vulns_import_id ON scanner_import_vulnerabilities(import_id);
CREATE INDEX idx_scanner_import_vulns_vulnerability_id ON scanner_import_vulnerabilities(vulnerability_id);

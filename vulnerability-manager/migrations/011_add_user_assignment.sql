-- Add user assignment to vulnerabilities table

-- Add assigned_user_id column if it doesn't exist
DO $$
BEGIN
    IF NOT EXISTS (
        SELECT 1 FROM information_schema.columns
        WHERE table_name = 'vulnerabilities'
        AND column_name = 'assigned_user_id'
    ) THEN
        ALTER TABLE vulnerabilities
        ADD COLUMN assigned_user_id UUID REFERENCES users(id) ON DELETE SET NULL;
    END IF;
END $$;

-- Create index for user assignments
CREATE INDEX IF NOT EXISTS idx_vulnerabilities_user_id ON vulnerabilities(assigned_user_id);

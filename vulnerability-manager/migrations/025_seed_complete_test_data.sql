-- Complete test data population for network topology and vulnerabilities
-- This script populates realistic data for testing the frontend

-- Clear existing data (optional - comment out if you want to preserve existing data)
DELETE FROM device_vulnerabilities;
DELETE FROM remediation_tasks;
DELETE FROM network_links;
DELETE FROM network_scans;
DELETE FROM vulnerabilities;
DELETE FROM network_devices;
DELETE FROM assets;
DELETE FROM resolutions;
DELETE FROM team_members;
DELETE FROM teams;
DELETE FROM users;

-- Insert users
INSERT INTO users (id, username, password_hash, email, role)
VALUES 
    ('550e8400-e29b-41d4-a716-446655440001', 'admin', '$argon2id$v=19$m=16,t=2,p=1$NzZJbmtsRzJpSnJZeVVVcg$YiDJHvIB/lbugIUOI+Nc6D3ZLok', 'admin@sentinelcore.local', 'admin'),
    ('550e8400-e29b-41d4-a716-446655440002', 'team_leader', '$argon2id$v=19$m=16,t=2,p=1$VVVKdHFLVmhiTXByRU5vNg$SvK49OLGFKs4jlMjpSPsVoZ0b80', 'teamleader@sentinelcore.local', 'team_leader'),
    ('550e8400-e29b-41d4-a716-446655440003', 'user1', '$argon2id$v=19$m=16,t=2,p=1$VVVKdHFLVmhiTXByRU5vNg$SvK49OLGFKs4jlMjpSPsVoZ0b80', 'user1@sentinelcore.local', 'user'),
    ('550e8400-e29b-41d4-a716-446655440004', 'user2', '$argon2id$v=19$m=16,t=2,p=1$VVVKdHFLVmhiTXByRU5vNg$SvK49OLGFKs4jlMjpSPsVoZ0b80', 'user2@sentinelcore.local', 'user');

-- Insert teams
INSERT INTO teams (id, name, description, contact_email)
VALUES 
    ('650e8400-e29b-41d4-a716-446655440001', 'IT Security', 'Main security team', 'security@sentinelcore.local'),
    ('650e8400-e29b-41d4-a716-446655440002', 'Network Operations', 'Network team', 'netops@sentinelcore.local'),
    ('650e8400-e29b-41d4-a716-446655440003', 'Infrastructure', 'Infrastructure team', 'infra@sentinelcore.local');

-- Insert team members
INSERT INTO team_members (team_id, name, email, user_id)
VALUES 
    ('650e8400-e29b-41d4-a716-446655440001', 'John Doe', 'john@sentinelcore.local', '550e8400-e29b-41d4-a716-446655440002'),
    ('650e8400-e29b-41d4-a716-446655440001', 'Jane Smith', 'jane@sentinelcore.local', '550e8400-e29b-41d4-a716-446655440003'),
    ('650e8400-e29b-41d4-a716-446655440002', 'Mike Johnson', 'mike@sentinelcore.local', '550e8400-e29b-41d4-a716-446655440004');

-- Insert network devices with realistic data
INSERT INTO network_devices (id, ip_address, mac_address, hostname, device_type, device_status, vendor, os_name, os_version, open_ports, services, first_seen, last_seen, criticality, owner, location, assigned_team_id)
VALUES
    ('750e8400-e29b-41d4-a716-446655440001', '192.168.1.1'::inet, '00:1a:2b:3c:4d:5e', 'router-core-01', 'router', 'online', 'Cisco', 'IOS', '15.9', '{22,80,443}', '{"ssh": "OpenSSH", "http": "nginx"}', NOW() - INTERVAL '30 days', NOW(), 'high', 'NetOps', 'Data Center', '650e8400-e29b-41d4-a716-446655440002'),
    ('750e8400-e29b-41d4-a716-446655440002', '192.168.1.10'::inet, '00:1a:2b:3c:4d:5f', 'web-server-01', 'server', 'online', 'Dell', 'Linux Ubuntu', '22.04 LTS', '{22,80,443,3000}', '{"ssh": "OpenSSH_8.2", "http": "Apache/2.4.41", "https": "Apache/2.4.41", "node": "Node.js 18"}', NOW() - INTERVAL '25 days', NOW(), 'critical', 'Infrastructure', 'Data Center', '650e8400-e29b-41d4-a716-446655440003'),
    ('750e8400-e29b-41d4-a716-446655440003', '192.168.1.11'::inet, '00:1a:2b:3c:4d:60', 'db-primary-01', 'server', 'online', 'HP', 'Linux CentOS', '8.5', '{22,5432,3306}', '{"ssh": "OpenSSH_7.4", "postgres": "PostgreSQL 14", "mysql": "MySQL 8.0"}', NOW() - INTERVAL '20 days', NOW(), 'critical', 'Infrastructure', 'Data Center', '650e8400-e29b-41d4-a716-446655440003'),
    ('750e8400-e29b-41d4-a716-446655440004', '192.168.1.12'::inet, '00:1a:2b:3c:4d:61', 'app-server-01', 'server', 'online', 'Lenovo', 'Linux Ubuntu', '20.04 LTS', '{22,8080,8443}', '{"ssh": "OpenSSH_7.6", "tomcat": "Tomcat/9.0"}', NOW() - INTERVAL '15 days', NOW(), 'high', 'Infrastructure', 'Data Center', '650e8400-e29b-41d4-a716-446655440003'),
    ('750e8400-e29b-41d4-a716-446655440005', '192.168.1.20'::inet, '00:1a:2b:3c:4d:62', 'firewall-01', 'firewall', 'online', 'Fortinet', 'FortiOS', '7.2.4', '{22,80,443}', '{"ssh": "OpenSSH", "https": "FortiGate"}', NOW() - INTERVAL '30 days', NOW(), 'critical', 'NetOps', 'Data Center', '650e8400-e29b-41d4-a716-446655440002'),
    ('750e8400-e29b-41d4-a716-446655440006', '192.168.1.21'::inet, '00:1a:2b:3c:4d:63', 'switch-01', 'switch', 'online', 'Cisco', 'IOS', '16.3', '{22,23,80}', '{"telnet": "Cisco", "ssh": "OpenSSH"}', NOW() - INTERVAL '30 days', NOW(), 'medium', 'NetOps', 'Data Center', '650e8400-e29b-41d4-a716-446655440002'),
    ('750e8400-e29b-41d4-a716-446655440007', '192.168.1.30'::inet, '00:1a:2b:3c:4d:64', 'mail-server-01', 'server', 'online', 'Dell', 'Linux Ubuntu', '22.04 LTS', '{22,25,110,143,587,993,995}', '{"ssh": "OpenSSH_8.2", "smtp": "Postfix", "imap": "Dovecot"}', NOW() - INTERVAL '10 days', NOW(), 'high', 'Infrastructure', 'Data Center', '650e8400-e29b-41d4-a716-446655440003'),
    ('750e8400-e29b-41d4-a716-446655440008', '192.168.1.40'::inet, '00:1a:2b:3c:4d:65', 'backup-server-01', 'server', 'online', 'IBM', 'Linux CentOS', '7.9', '{22,9103}', '{"ssh": "OpenSSH_7.4", "backup": "Bacula"}', NOW() - INTERVAL '8 days', NOW(), 'medium', 'Infrastructure', 'Data Center', '650e8400-e29b-41d4-a716-446655440003'),
    ('750e8400-e29b-41d4-a716-446655440009', '192.168.1.50'::inet, '00:1a:2b:3c:4d:66', 'workstation-01', 'workstation', 'online', 'Dell', 'Windows', '10 Enterprise', '{22,445,3389}', '{"rdp": "RDP", "smb": "Samba"}', NOW() - INTERVAL '5 days', NOW(), 'low', 'IT Security', 'Office', '650e8400-e29b-41d4-a716-446655440001'),
    ('750e8400-e29b-41d4-a716-446655440010', '192.168.1.51'::inet, '00:1a:2b:3c:4d:67', 'workstation-02', 'workstation', 'online', 'HP', 'Windows', '11 Pro', '{22,445,3389}', '{"rdp": "RDP", "smb": "Samba"}', NOW() - INTERVAL '3 days', NOW(), 'low', 'IT Security', 'Office', '650e8400-e29b-41d4-a716-446655440001'),
    ('750e8400-e29b-41d4-a716-446655440011', '192.168.2.1'::inet, '00:2a:2b:3c:4d:68', 'api-gateway-01', 'server', 'online', 'Dell', 'Linux Ubuntu', '22.04 LTS', '{22,80,443,8080}', '{"ssh": "OpenSSH_8.2", "http": "nginx/1.25", "api": "Kong"}', NOW() - INTERVAL '12 days', NOW(), 'critical', 'Infrastructure', 'Cloud', '650e8400-e29b-41d4-a716-446655440003'),
    ('750e8400-e29b-41d4-a716-446655440012', '192.168.2.2'::inet, '00:2a:2b:3c:4d:69', 'cache-01', 'server', 'online', 'Dell', 'Linux Ubuntu', '20.04 LTS', '{22,6379,11211}', '{"ssh": "OpenSSH_7.6", "redis": "Redis 7.0", "memcached": "Memcached"}', NOW() - INTERVAL '7 days', NOW(), 'high', 'Infrastructure', 'Cloud', '650e8400-e29b-41d4-a716-446655440003'),
    ('750e8400-e29b-41d4-a716-446655440013', '192.168.2.3'::inet, '00:2a:2b:3c:4d:6a', 'auth-server-01', 'server', 'online', 'Dell', 'Linux CentOS', '8.5', '{22,389,636,88,464}', '{"ssh": "OpenSSH_7.4", "ldap": "OpenLDAP", "kerberos": "Kerberos"}', NOW() - INTERVAL '20 days', NOW(), 'critical', 'Infrastructure', 'Data Center', '650e8400-e29b-41d4-a716-446655440003'),
    ('750e8400-e29b-41d4-a716-446655440014', '192.168.2.4'::inet, '00:2a:2b:3c:4d:6b', 'monitoring-01', 'server', 'online', 'Dell', 'Linux Ubuntu', '22.04 LTS', '{22,9090,3000}', '{"ssh": "OpenSSH_8.2", "prometheus": "Prometheus", "grafana": "Grafana"}', NOW() - INTERVAL '6 days', NOW(), 'high', 'NetOps', 'Data Center', '650e8400-e29b-41d4-a716-446655440002'),
    ('750e8400-e29b-41d4-a716-446655440015', '192.168.2.5'::inet, '00:2a:2b:3c:4d:6c', 'siem-01', 'server', 'online', 'Dell', 'Linux Ubuntu', '22.04 LTS', '{22,514,5044,9200}', '{"ssh": "OpenSSH_8.2", "syslog": "rsyslog", "elasticsearch": "Elasticsearch"}', NOW() - INTERVAL '9 days', NOW(), 'critical', 'IT Security', 'Data Center', '650e8400-e29b-41d4-a716-446655440001'),
    ('750e8400-e29b-41d4-a716-446655440016', '192.168.2.10'::inet, '00:2a:2b:3c:4d:6d', 'vpn-gateway-01', 'server', 'online', 'Juniper', 'Junos', '21.2', '{22,500,4500}', '{"ssh": "OpenSSH", "ipsec": "IPSec"}', NOW() - INTERVAL '18 days', NOW(), 'critical', 'NetOps', 'Data Center', '650e8400-e29b-41d4-a716-446655440002'),
    ('750e8400-e29b-41d4-a716-446655440017', '192.168.3.1'::inet, '00:3a:2b:3c:4d:6e', 'iot-device-01', 'iot', 'online', 'Raspberry Pi', 'Linux', '11.0', '{22,8888}', '{"ssh": "OpenSSH_7.4", "api": "custom"}', NOW() - INTERVAL '4 days', NOW(), 'low', 'Infrastructure', 'Office', '650e8400-e29b-41d4-a716-446655440003'),
    ('750e8400-e29b-41d4-a716-446655440018', '192.168.3.2'::inet, '00:3a:2b:3c:4d:6f', 'iot-device-02', 'iot', 'online', 'Arduino', 'Custom OS', '2.1', '{80,8080}', '{"http": "simple_server"}', NOW() - INTERVAL '2 days', NOW(), 'medium', 'Infrastructure', 'Office', '650e8400-e29b-41d4-a716-446655440003'),
    ('750e8400-e29b-41d4-a716-446655440019', '192.168.4.1'::inet, '00:4a:2b:3c:4d:70', 'printer-01', 'printer', 'online', 'HP', 'Linux', '4.2', '{9100,515}', '{"lpd": "CUPS", "ipp": "IPP"}', NOW() - INTERVAL '14 days', NOW(), 'low', 'Infrastructure', 'Office', '650e8400-e29b-41d4-a716-446655440003'),
    ('750e8400-e29b-41d4-a716-446655440020', '192.168.4.100'::inet, '00:4a:2b:3c:4d:71', 'unknown-device-01', 'unknown', 'unknown', 'Unknown', 'Unknown', 'Unknown', '{}'::INTEGER[], '{}'::JSONB, NOW() - INTERVAL '1 day', NOW() - INTERVAL '1 day', 'low', 'Unknown', 'Unknown', NULL);

-- Insert assets (vulnerability management assets, separate from network devices)
INSERT INTO assets (id, name, asset_type, description, ip_address, hostname, mac_address, operating_system, owner, location, tags, criticality)
VALUES
    ('850e8400-e29b-41d4-a716-446655440001', 'Production Web App', 'application', 'Main production web application', '192.168.1.10', 'web-server-01', '00:1a:2b:3c:4d:5f', 'Linux Ubuntu 22.04 LTS', 'Infrastructure Team', 'Data Center', ARRAY['production', 'web', 'critical']::text[], 'Critical'),
    ('850e8400-e29b-41d4-a716-446655440002', 'Payment Service', 'application', 'Payment processing service', '192.168.1.12', 'app-server-01', '00:1a:2b:3c:4d:61', 'Linux Ubuntu 20.04 LTS', 'Infrastructure Team', 'Data Center', ARRAY['production', 'payment', 'pci']::text[], 'Critical'),
    ('850e8400-e29b-41d4-a716-446655440003', 'API Gateway', 'application', 'API gateway for microservices', '192.168.2.1', 'api-gateway-01', '00:2a:2b:3c:4d:68', 'Linux Ubuntu 22.04 LTS', 'Infrastructure Team', 'Cloud', ARRAY['production', 'api', 'gateway']::text[], 'Critical'),
    ('850e8400-e29b-41d4-a716-446655440004', 'Database Primary', 'server', 'Primary database server', '192.168.1.11', 'db-primary-01', '00:1a:2b:3c:4d:60', 'Linux CentOS 8.5', 'Infrastructure Team', 'Data Center', ARRAY['production', 'database', 'backup']::text[], 'Critical'),
    ('850e8400-e29b-41d4-a716-446655440005', 'Mail Server', 'server', 'Corporate email server', '192.168.1.30', 'mail-server-01', '00:1a:2b:3c:4d:64', 'Linux Ubuntu 22.04 LTS', 'Infrastructure Team', 'Data Center', ARRAY['production', 'email', 'communication']::text[], 'High'),
    ('850e8400-e29b-41d4-a716-446655440006', 'Backup Server', 'server', 'Backup and disaster recovery', '192.168.1.40', 'backup-server-01', '00:1a:2b:3c:4d:65', 'Linux CentOS 7.9', 'Infrastructure Team', 'Data Center', ARRAY['production', 'backup', 'disaster-recovery']::text[], 'High'),
    ('850e8400-e29b-41d4-a716-446655440007', 'SIEM', 'server', 'Security Information and Event Management', '192.168.2.5', 'siem-01', '00:2a:2b:3c:4d:6c', 'Linux Ubuntu 22.04 LTS', 'IT Security Team', 'Data Center', ARRAY['security', 'siem', 'monitoring', 'critical']::text[], 'Critical'),
    ('850e8400-e29b-41d4-a716-446655440008', 'Monitoring Stack', 'server', 'Prometheus and Grafana monitoring', '192.168.2.4', 'monitoring-01', '00:2a:2b:3c:4d:6b', 'Linux Ubuntu 22.04 LTS', 'NetOps Team', 'Data Center', ARRAY['operations', 'monitoring', 'observability']::text[], 'High'),
    ('850e8400-e29b-41d4-a716-446655440009', 'Auth Service', 'server', 'LDAP and Kerberos authentication', '192.168.2.3', 'auth-server-01', '00:2a:2b:3c:4d:6a', 'Linux CentOS 8.5', 'Infrastructure Team', 'Data Center', ARRAY['security', 'authentication', 'critical']::text[], 'Critical'),
    ('850e8400-e29b-41d4-a716-446655440010', 'Cache Layer', 'server', 'Redis and Memcached caching', '192.168.2.2', 'cache-01', '00:2a:2b:3c:4d:69', 'Linux Ubuntu 20.04 LTS', 'Infrastructure Team', 'Cloud', ARRAY['performance', 'caching', 'infrastructure']::text[], 'High'),
    ('850e8400-e29b-41d4-a716-446655440011', 'VPN Gateway', 'network', 'VPN and remote access gateway', '192.168.2.10', 'vpn-gateway-01', '00:2a:2b:3c:4d:6d', 'Juniper Junos 21.2', 'NetOps Team', 'Data Center', ARRAY['network', 'vpn', 'security', 'remote-access']::text[], 'Critical'),
    ('850e8400-e29b-41d4-a716-446655440012', 'Firewall', 'network', 'Perimeter firewall', '192.168.1.20', 'firewall-01', '00:1a:2b:3c:4d:62', 'Fortinet FortiOS 7.2.4', 'NetOps Team', 'Data Center', ARRAY['network', 'security', 'perimeter', 'critical']::text[], 'Critical');

-- Insert vulnerabilities with various severity levels
INSERT INTO vulnerabilities (id, title, description, cvss_score, epss_score, ip_address, hostname, port, protocol, status, severity, cve_id, remediation, source, discovered_at, assigned_team_id)
VALUES
    ('950e8400-e29b-41d4-a716-446655440001', 'Remote Code Execution in Apache Struts', 'CVE-2023-50164 allows remote code execution via deserialization', 9.8, 0.95, '192.168.1.10', 'web-server-01', 80, 'HTTP', 'open', 'critical', 'CVE-2023-50164', 'Update Apache Struts to version 2.6.1 or later', 'Nessus', NOW() - INTERVAL '5 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440002', 'SQL Injection in Login Form', 'Unauthenticated SQL injection in the login page', 9.3, 0.85, '192.168.1.10', 'web-server-01', 443, 'HTTPS', 'open', 'critical', 'CVE-2023-12345', 'Implement parameterized queries and input validation', 'Burp Suite', NOW() - INTERVAL '7 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440003', 'Insecure Deserialization in Java', 'Unsafe deserialization in payment service', 8.9, 0.75, '192.168.1.12', 'app-server-01', 8080, 'HTTP', 'open', 'critical', 'CVE-2023-45678', 'Upgrade Java libraries and disable deserialization of untrusted data', 'Manual Review', NOW() - INTERVAL '3 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440004', 'OpenSSL Vulnerability', 'OpenSSL CVE affecting TLS connections', 7.5, 0.65, '192.168.1.11', 'db-primary-01', 5432, 'TCP', 'open', 'high', 'CVE-2023-44487', 'Update OpenSSL to version 3.1.2 or later', 'Nessus', NOW() - INTERVAL '10 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440005', 'Weak SSL/TLS Configuration', 'Server accepts weak cipher suites', 7.2, 0.60, '192.168.1.30', 'mail-server-01', 587, 'SMTP', 'open', 'high', 'CVE-2023-38709', 'Disable weak ciphers and enforce TLS 1.2+', 'SSL Labs', NOW() - INTERVAL '12 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440006', 'XSS Vulnerability in Admin Panel', 'Reflected XSS in admin dashboard', 6.8, 0.55, '192.168.1.10', 'web-server-01', 443, 'HTTPS', 'open', 'high', 'CVE-2023-22345', 'Implement output encoding and CSP headers', 'OWASP ZAP', NOW() - INTERVAL '8 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440007', 'Outdated ImageMagick', 'ImageMagick library with known RCE', 8.2, 0.70, '192.168.1.12', 'app-server-01', 3000, 'HTTP', 'open', 'high', 'CVE-2023-34152', 'Update ImageMagick to latest version and restrict ImageTragick policy', 'Nessus', NOW() - INTERVAL '6 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440008', 'Missing HTTP Security Headers', 'Missing HSTS, X-Frame-Options headers', 5.3, 0.45, '192.168.1.10', 'web-server-01', 80, 'HTTP', 'open', 'medium', 'CWE-693', 'Add security headers to all HTTP responses', 'Manual Review', NOW() - INTERVAL '15 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440009', 'Weak Password Policy', 'Minimum password requirements not enforced', 4.8, 0.35, '192.168.2.3', 'auth-server-01', 389, 'LDAP', 'open', 'medium', 'CWE-521', 'Enforce strong password policy with minimum requirements', 'Policy Review', NOW() - INTERVAL '20 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440010', 'Missing Security Updates', 'PostgreSQL version 14.3 needs patches', 5.9, 0.50, '192.168.1.11', 'db-primary-01', 5432, 'TCP', 'open', 'medium', 'CVE-2023-39417', 'Update PostgreSQL to version 14.9 or later', 'Patch Manager', NOW() - INTERVAL '11 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440011', 'SSH Weak Authentication', 'SSH allows password authentication', 5.7, 0.48, '192.168.1.1', 'router-core-01', 22, 'SSH', 'open', 'medium', 'CWE-307', 'Disable SSH password auth, enable key-based only', 'Manual Review', NOW() - INTERVAL '22 days', '650e8400-e29b-41d4-a716-446655440002'),
    ('950e8400-e29b-41d4-a716-446655440012', 'Unencrypted Data Transmission', 'Telnet enabled on switch', 6.5, 0.52, '192.168.1.21', 'switch-01', 23, 'Telnet', 'open', 'high', 'CWE-319', 'Disable Telnet, use SSH exclusively', 'Network Scan', NOW() - INTERVAL '18 days', '650e8400-e29b-41d4-a716-446655440002'),
    ('950e8400-e29b-41d4-a716-446655440013', 'Default Credentials', 'Default credentials still active on firewall', 7.9, 0.68, '192.168.1.20', 'firewall-01', 443, 'HTTPS', 'open', 'high', 'CWE-798', 'Change all default credentials immediately', 'Manual Review', NOW() - INTERVAL '9 days', '650e8400-e29b-41d4-a716-446655440002'),
    ('950e8400-e29b-41d4-a716-446655440014', 'Unsecured API Endpoint', 'API endpoint accessible without authentication', 7.3, 0.62, '192.168.2.1', 'api-gateway-01', 8080, 'HTTP', 'open', 'high', 'CWE-862', 'Implement API authentication and rate limiting', 'OWASP ZAP', NOW() - INTERVAL '4 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440015', 'Information Disclosure', 'Stack traces exposed in error pages', 5.3, 0.40, '192.168.1.10', 'web-server-01', 443, 'HTTPS', 'open', 'medium', 'CWE-209', 'Implement generic error pages and disable debug logging', 'Manual Review', NOW() - INTERVAL '13 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440016', 'Insufficient Input Validation', 'File upload without proper validation', 6.3, 0.51, '192.168.1.12', 'app-server-01', 8080, 'HTTP', 'open', 'medium', 'CWE-434', 'Validate file types, size, and scan for malware', 'Code Review', NOW() - INTERVAL '6 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440017', 'Privilege Escalation', 'Service running with unnecessary privileges', 6.0, 0.48, '192.168.2.5', 'siem-01', 9200, 'HTTP', 'open', 'medium', 'CWE-269', 'Run services with minimum required privileges', 'Manual Review', NOW() - INTERVAL '7 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440018', 'Unpatched Library', 'log4j version 2.14 with known vulnerability', 9.0, 0.80, '192.168.2.5', 'siem-01', 514, 'Syslog', 'open', 'critical', 'CVE-2021-44228', 'Update log4j to version 2.17.1 or later', 'Dependency Check', NOW() - INTERVAL '2 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440019', 'Insecure Deserialization', 'Java object deserialization without validation', 8.7, 0.72, '192.168.2.4', 'monitoring-01', 9090, 'HTTP', 'open', 'critical', 'CVE-2023-38545', 'Update dependencies and disable dangerous deserializers', 'Code Review', NOW() - INTERVAL '3 days', '650e8400-e29b-41d4-a716-446655440001'),
    ('950e8400-e29b-41d4-a716-446655440020', 'Network Service Enumeration', 'Unnecessary network services exposed', 4.3, 0.32, '192.168.1.40', 'backup-server-01', 9103, 'HTTP', 'open', 'low', 'CWE-636', 'Disable unnecessary services and close unused ports', 'Port Scan', NOW() - INTERVAL '14 days', '650e8400-e29b-41d4-a716-446655440003');

-- Associate vulnerabilities with network devices
INSERT INTO device_vulnerabilities (id, device_id, vulnerability_id, discovered_at)
VALUES
    -- Web server vulnerabilities
    ('a50e8400-e29b-41d4-a716-446655440001', '750e8400-e29b-41d4-a716-446655440002', '950e8400-e29b-41d4-a716-446655440001', NOW() - INTERVAL '5 days'),
    ('a50e8400-e29b-41d4-a716-446655440002', '750e8400-e29b-41d4-a716-446655440002', '950e8400-e29b-41d4-a716-446655440002', NOW() - INTERVAL '7 days'),
    ('a50e8400-e29b-41d4-a716-446655440003', '750e8400-e29b-41d4-a716-446655440002', '950e8400-e29b-41d4-a716-446655440006', NOW() - INTERVAL '8 days'),
    ('a50e8400-e29b-41d4-a716-446655440004', '750e8400-e29b-41d4-a716-446655440002', '950e8400-e29b-41d4-a716-446655440008', NOW() - INTERVAL '15 days'),
    ('a50e8400-e29b-41d4-a716-446655440005', '750e8400-e29b-41d4-a716-446655440002', '950e8400-e29b-41d4-a716-446655440015', NOW() - INTERVAL '13 days'),
    -- App server vulnerabilities
    ('a50e8400-e29b-41d4-a716-446655440006', '750e8400-e29b-41d4-a716-446655440004', '950e8400-e29b-41d4-a716-446655440003', NOW() - INTERVAL '3 days'),
    ('a50e8400-e29b-41d4-a716-446655440007', '750e8400-e29b-41d4-a716-446655440004', '950e8400-e29b-41d4-a716-446655440007', NOW() - INTERVAL '6 days'),
    ('a50e8400-e29b-41d4-a716-446655440008', '750e8400-e29b-41d4-a716-446655440004', '950e8400-e29b-41d4-a716-446655440016', NOW() - INTERVAL '6 days'),
    -- Database server vulnerabilities
    ('a50e8400-e29b-41d4-a716-446655440009', '750e8400-e29b-41d4-a716-446655440003', '950e8400-e29b-41d4-a716-446655440004', NOW() - INTERVAL '10 days'),
    ('a50e8400-e29b-41d4-a716-446655440010', '750e8400-e29b-41d4-a716-446655440003', '950e8400-e29b-41d4-a716-446655440010', NOW() - INTERVAL '11 days'),
    -- Mail server vulnerabilities
    ('a50e8400-e29b-41d4-a716-446655440011', '750e8400-e29b-41d4-a716-446655440007', '950e8400-e29b-41d4-a716-446655440005', NOW() - INTERVAL '12 days'),
    -- Router vulnerabilities
    ('a50e8400-e29b-41d4-a716-446655440012', '750e8400-e29b-41d4-a716-446655440001', '950e8400-e29b-41d4-a716-446655440011', NOW() - INTERVAL '22 days'),
    -- Switch vulnerabilities
    ('a50e8400-e29b-41d4-a716-446655440013', '750e8400-e29b-41d4-a716-446655440006', '950e8400-e29b-41d4-a716-446655440012', NOW() - INTERVAL '18 days'),
    -- Firewall vulnerabilities
    ('a50e8400-e29b-41d4-a716-446655440014', '750e8400-e29b-41d4-a716-446655440005', '950e8400-e29b-41d4-a716-446655440013', NOW() - INTERVAL '9 days'),
    -- API Gateway vulnerabilities
    ('a50e8400-e29b-41d4-a716-446655440015', '750e8400-e29b-41d4-a716-446655440011', '950e8400-e29b-41d4-a716-446655440014', NOW() - INTERVAL '4 days'),
    ('a50e8400-e29b-41d4-a716-446655440016', '750e8400-e29b-41d4-a716-446655440011', '950e8400-e29b-41d4-a716-446655440001', NOW() - INTERVAL '5 days'),
    -- Backup server vulnerabilities
    ('a50e8400-e29b-41d4-a716-446655440017', '750e8400-e29b-41d4-a716-446655440008', '950e8400-e29b-41d4-a716-446655440020', NOW() - INTERVAL '14 days'),
    -- SIEM vulnerabilities
    ('a50e8400-e29b-41d4-a716-446655440018', '750e8400-e29b-41d4-a716-446655440015', '950e8400-e29b-41d4-a716-446655440018', NOW() - INTERVAL '2 days'),
    ('a50e8400-e29b-41d4-a716-446655440019', '750e8400-e29b-41d4-a716-446655440015', '950e8400-e29b-41d4-a716-446655440019', NOW() - INTERVAL '3 days'),
    -- Monitoring server vulnerabilities
    ('a50e8400-e29b-41d4-a716-446655440020', '750e8400-e29b-41d4-a716-446655440014', '950e8400-e29b-41d4-a716-446655440019', NOW() - INTERVAL '3 days'),
    -- Auth server vulnerabilities
    ('a50e8400-e29b-41d4-a716-446655440021', '750e8400-e29b-41d4-a716-446655440013', '950e8400-e29b-41d4-a716-446655440009', NOW() - INTERVAL '20 days');

-- Add device assignment to team for network devices
UPDATE network_devices SET assigned_team_id = '650e8400-e29b-41d4-a716-446655440003' WHERE device_type IN ('server');
UPDATE network_devices SET assigned_team_id = '650e8400-e29b-41d4-a716-446655440002' WHERE device_type IN ('router', 'switch', 'firewall');

-- Create basic remediation info for devices
ALTER TABLE network_devices ADD COLUMN IF NOT EXISTS remediation_info JSONB DEFAULT '{"pendingRemediations": 0}';
UPDATE network_devices SET remediation_info = jsonb_build_object(
    'pendingRemediations', (SELECT COUNT(*) FROM device_vulnerabilities dv WHERE dv.device_id = network_devices.id),
    'completedRemediations', 0,
    'failedRemediations', 0
);

-- Create assignment info for devices with teams
ALTER TABLE network_devices ADD COLUMN IF NOT EXISTS assignment JSONB DEFAULT NULL;
UPDATE network_devices SET assignment = jsonb_build_object(
    'assignedTeamId', assigned_team_id,
    'assignedTeamName', (SELECT name FROM teams WHERE id = assigned_team_id)
) WHERE assigned_team_id IS NOT NULL;

-- Migration 007: User Settings
-- Stores user preferences and configuration

-- Create user_settings table
CREATE TABLE IF NOT EXISTS user_settings (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,

    -- Notification preferences
    notifications JSONB DEFAULT '{"email": true, "push": false, "critical": true, "weekly": false}'::jsonb,

    -- Security settings
    security JSONB DEFAULT '{"twoFactor": false, "sessionTimeout": "30", "ipWhitelist": false}'::jsonb,

    -- Integration settings
    integrations JSONB DEFAULT '{}'::jsonb,

    -- General preferences
    preferences JSONB DEFAULT '{}'::jsonb,

    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    UNIQUE(user_id)
);

-- Create index on user_id
CREATE INDEX IF NOT EXISTS idx_user_settings_user_id ON user_settings(user_id);

-- Create update trigger
CREATE TRIGGER update_user_settings_updated_at
    BEFORE UPDATE ON user_settings
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();

-- Comment
COMMENT ON TABLE user_settings IS 'Stores user preferences and application settings';
COMMENT ON COLUMN user_settings.notifications IS 'Notification preferences (email, push, critical alerts, weekly reports)';
COMMENT ON COLUMN user_settings.security IS 'Security settings (2FA, session timeout, IP whitelist)';
COMMENT ON COLUMN user_settings.integrations IS 'External integration settings (Nessus, Qualys, etc)';
COMMENT ON COLUMN user_settings.preferences IS 'General user preferences (theme, language, etc)';
